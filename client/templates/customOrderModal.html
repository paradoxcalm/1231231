<div class="legacy-request-modal">
  <style>
    .legacy-request-modal {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .legacy-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e0e0e0;
    }
    .legacy-modal-header h2 {
      margin: 0;
      font-size: 22px;
      font-weight: 600;
    }
    .legacy-modal-close {
      background: none;
      border: none;
      font-size: 28px;
      line-height: 1;
      cursor: pointer;
      color: #888;
      padding: 4px 8px;
    }
    .legacy-modal-close:hover {
      color: #222;
    }
    .legacy-modal-body {
      max-height: 75vh;
      overflow-y: auto;
      padding-right: 4px;
    }
    @media (max-width: 768px) {
      .legacy-modal-header {
        padding-bottom: 0;
        border-bottom: none;
      }
      .legacy-modal-body {
        max-height: none;
      }
    }
  </style>
  <div class="legacy-modal-header">
    <h2>Оформление заявки</h2>
    <button type="button" class="legacy-modal-close" data-close-modal aria-label="Закрыть форму">&times;</button>
  </div>
  <div class="legacy-modal-body">
    <div class="section-container">
      <style>
        .static-field {
          display: block;
          width: 100%;
          padding: 8px 12px;
          margin-top: 4px;
          margin-bottom: 16px;
          border: 1px solid #ccc;
          border-radius: 4px;
          background-color: #f5f5f5;
          text-align: center;
          font-weight: bold;
        }
      </style>
      <form id="dataForm" enctype="multipart/form-data">
        <h1 class="section-title">ПРИЁМКА</h1>

        <input type="hidden" name="schedule_id" id="formScheduleId" value="">
        <input type="hidden" name="accept_date" id="acceptDateField" value="">
        <input type="hidden" name="delivery_date" id="deliveryDateField" value="">
        <input type="hidden" name="date_of_delivery" id="deliveryDateAlias" value="">
        <input type="hidden" name="accept_time" id="acceptTimeField" value="">
        <input type="hidden" name="direction" id="directionField" value="">

        <div class="form-group">
          <label>Направление:</label>
          <div class="static-field" id="legacyDirection">—</div>
        </div>

        <div class="form-group">
          <label>Выезд → Сдача:</label>
          <div class="static-field" id="legacyDates">—</div>
        </div>

        <input type="hidden" id="city" name="city" value="">
        <input type="hidden" id="warehouses" name="warehouses" value="">
        <input type="hidden" id="driver_name" name="driver_name" value="">
        <input type="hidden" id="driver_phone" name="driver_phone" value="">
        <input type="hidden" id="car_number" name="car_number" value="">
        <input type="hidden" id="car_brand" name="car_brand" value="">
        <input type="hidden" id="sender" name="sender" value="">

        <div class="form-group">
          <label class="section-label">Тип упаковки:</label>
          <div style="display:flex;gap:40px;justify-content:center;">
            <label><input type="radio" name="packaging_type" value="Box" checked> Коробка</label>
            <label><input type="radio" name="packaging_type" value="Pallet"> Паллета</label>
          </div>
        </div>

        <div class="form-group">
          <label for="boxes">Количество:</label>
          <input type="number" id="boxes" name="boxes" min="1" required>
        </div>

        <div id="palletInputBlock" class="form-group" style="display:none;">
          <label>Параметры палет:</label>
          <div id="palletFields"></div>
          <p id="palletWarning" style="color:red; display:none;">Максимум 20 палет</p>
        </div>

        <div class="form-group" id="boxTypeBlock">
          <label class="section-label">Тип коробки:</label>
          <div style="display:flex;gap:40px;justify-content:center;">
            <label><input type="radio" name="box_type" value="standard" checked> Стандарт (60×40×40)</label>
            <label><input type="radio" name="box_type" value="custom"> Свои размеры</label>
          </div>
        </div>

        <div class="form-group" id="boxSizeBlock">
          <label>Габариты одной коробки (см):</label>
          <div style="display:flex;gap:10px;justify-content:center;">
            <input type="number" id="box_length" name="box_length" placeholder="Длина" style="width:70px;">
            <input type="number" id="box_width" name="box_width" placeholder="Ширина" style="width:70px;">
            <input type="number" id="box_height" name="box_height" placeholder="Высота" style="width:70px;">
          </div>
        </div>

        <div class="form-group" id="customBoxFieldsBlock" style="display:none;">
          <label>Свои группы коробов:</label>
          <input type="number" id="customBoxGroupCount" min="1" max="10" placeholder="Кол-во групп" style="width:100px;">
          <div id="customBoxFields" style="margin-top:10px;"></div>
          <p id="customBoxWarning" style="color:red; display:none;">Сумма количеств в группах не должна превышать общее количество коробов</p>
        </div>

        <div class="form-group"><label>Общий объём:</label><span id="box_volume">—</span></div>
        <div class="form-group"><label>Тариф:</label><span id="tariff_rate">—</span></div>
        <div class="form-group"><label for="payment">Сумма оплаты:</label>
          <input type="number" id="payment" name="payment" readonly>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="pickupCheckbox" name="pickup_checkbox">
            Забрать груз с адреса отправителя
          </label>
        </div>

        <div id="pickupAddressFields" style="display:none; padding:10px; border:1px solid #ddd; border-radius:4px;">
          <div id="pickupMap" style="width:100%; height:300px; border:1px solid #ccc; margin-bottom:8px;"></div>

          <input type="hidden" id="pickupLat" name="pickup_lat">
          <input type="hidden" id="pickupLng" name="pickup_lng">

          <label for="clientPhone">Номер для связи:</label>
          <input type="tel" id="clientPhone" name="client_phone" placeholder="+7 (999) 123-45-67" style="width:100%; margin-bottom:8px;">

          <div id="routeBlock" style="display:none; margin-top:10px;">
            <label>Ссылка для навигатора:</label><br>
            <a id="routeLinkYandex" href="#" target="_blank" style="margin-right:10px;"></a>
            <a id="routeLinkGoogle" href="#" target="_blank"></a>
            <button type="button" id="routeCopyBtn" style="margin-left:10px;">Копировать</button>
          </div>
        </div>

        <div class="form-group">
          <label for="comment">Комментарий:</label>
          <textarea id="comment" name="comment" rows="3" placeholder="Введите комментарий"></textarea>
        </div>
        <button type="submit">Отправить</button>
      </form>
      <p id="status"></p>
    </div>
  </div>
</div>
